# 财务数据表结构文档

## 数据表概览

本目录包含两个核心财务数据表：

1. **final_enhanced_balance.csv** - 增强版科目余额表
2. **final_voucher_detail.csv** - 凭证明细表

## 1. final_enhanced_balance.csv - 增强版科目余额表

### 数据特征
- **数据规模**: 8,666 行 × 17 列
- **时间覆盖**: 2023年 - 2025年7月
- **公司范围**: 
  - 广东金发复合材料有限公司
  - 广州金发碳纤维新材料发展有限公司

### 字段说明

#### 核心字段
| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| 科目编码 | string | 会计科目编码，支持多级结构（如：1002.01.01） |
| 科目名称 | string | 会计科目名称，核算维度行为空 |
| 核算维度编码 | string | 核算维度编码，普通科目行为空。编码规则：类型.序号（如：1.01.0023 表示供应商类型第0023号） |
| 核算维度名称 | string | 核算维度具体名称，普通科目行为空。包含供应商、客户、部门、项目等详细信息 |

#### 余额字段（单位：元）
| 字段名 | 说明 |
|--------|------|
| 期初余额借方 | 期初借方余额 |
| 期初余额贷方 | 期初贷方余额 |
| 本年累计借方 | 本年累计借方发生额 |
| 本年累计贷方 | 本年累计贷方发生额 |
| 期末余额借方 | 期末借方余额 |
| 期末余额贷方 | 期末贷方余额 |

#### 增强字段
| 字段名 | 说明 |
|--------|------|
| subject_code_path | 科目编码层级路径 |
| subject_name_path | 科目名称层级路径 |
| is_dimension_row | 是否核算维度行 |

#### 元数据字段
| 字段名 | 说明 |
|--------|------|
| 文件来源 | 原始数据文件来源 |
| 公司 | 公司名称 |
| 期间 | 会计期间 |
| 币别 | 货币类型 |

### 数据特性
- **层级结构**: 支持多级科目查询，如 `LIKE '/1002/%'`
- **核算维度**: 通过 `is_dimension_row` 区分普通科目和核算维度行
- **维度类型**: 包含多种核算维度类型：
  - **供应商维度**: 如 "佩尔哲汽车内饰系统（太仓）有限公司北京分公司"
  - **客户维度**: 如 "比亚迪汽车工业有限公司"  
  - **部门维度**: 各部门费用核算
  - **项目维度**: 项目成本核算
- **数据完整性**: 保持所有原始财务数据，包括完整的核算维度明细

## 2. final_voucher_detail.csv - 凭证明细表

### 数据特征
- **数据规模**: 52,170 行 × 27 列
- **时间覆盖**: 2024年1月 - 2025年6月

### 字段说明

#### 核心凭证信息
| 字段名 | 说明 |
|--------|------|
| 分录行号 | 凭证分录行号 |
| 日期 | 业务发生日期 |
| 凭证字 | 凭证类型 |
| 凭证号 | 凭证编号 |
| 摘要 | 业务摘要说明 |
| 科目编码 | 会计科目编码 |
| 科目全名 | 会计科目全名 |

#### 金额信息
| 字段名 | 说明 |
|--------|------|
| 借方金额 | 借方金额 |
| 贷方金额 | 贷方金额 |

#### 业务流程
| 字段名 | 说明 |
|--------|------|
| 制单 | 制单人 |
| 审核 | 审核人 |
| 过账 | 过账人 |

## 数据关联关系

### 表间关联
1. **科目关联**: 通过 `科目编码` 字段关联
2. **期间关联**: 通过 `期间` 字段关联
3. **公司关联**: 通过 `公司` 字段关联

### 查询示例
```sql
SELECT b.科目编码, b.subject_name_path, SUM(v.借方金额) as 借方合计
FROM final_enhanced_balance b
LEFT JOIN final_voucher_detail v ON b.科目编码 = v.科目编码
WHERE b.subject_code_path LIKE '/1121/%'
GROUP BY b.科目编码, b.subject_name_path
```

## 使用指南

### 通用数据分析
- **科目查询**: 使用层级路径字段进行高效科目查询（如 `subject_code_path LIKE '/1002/%'`）
- **余额分析**: 分析各科目的期初、期末余额及本年累计发生额
- **期间比较**: 按会计期间对比财务数据变化趋势
- **公司对比**: 分析不同公司间的财务数据差异

### 核算维度分析
- **维度识别**: 使用 `is_dimension_row = True` 筛选核算维度数据
- **供应商分析**: 查询应付账款科目的供应商往来明细
- **客户分析**: 查询应收账款科目的客户往来明细
- **多维分析**: 结合科目和维度进行深度财务分析

### 表间关联分析
- **余额凭证核对**: 通过科目编码关联余额表和凭证明细表
- **发生额验证**: 核对本年累计发生额与凭证实际发生额
- **完整性检查**: 确保所有凭证数据都在余额表中有对应记录

### 技术提示
- 使用Pandas进行高效数据加载和分析
- 利用层级路径优化查询性能
- 注意核算维度行的特殊处理方式

## 版本信息

**当前版本**: 2025年8月
**处理说明**: 科目余额表已进行层级优化和核算维度清理